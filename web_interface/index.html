<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis - Assistant Vocal</title>
    <link rel="stylesheet" href="static/styles/index.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
</head>
<body class="theme-light">
    <!-- Header avec navigation -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-icon">ü§ñ</span>
                <span class="logo-text" id="assistant-name">Jarvis - initialisation</span>
                <span class="status-indicator" id="status-indicator">‚óè</span>
            </div>
        </div>
        
        <nav class="header-nav">
            <button class="nav-btn" onclick="toggleVoiceLab()">
                <span class="icon">üé≠</span> Clonage Voix
            </button>
            <button class="nav-btn" onclick="toggleCameraPanel()">
                <span class="icon">üì∑</span> Vision IA
            </button>

            <!-- üé® UX: Bouton R√¥les accessible -->
            <button class="nav-btn" onclick="promptManager.openManager()">
                <span class="icon">üìù</span> R√¥les
            </button>

            <button class="nav-btn" onclick="openSettings()">
                <span class="icon">‚öôÔ∏è</span> Param√®tres
            </button>
            <button class="nav-btn" onclick="toggleDebug()">
                <span class="icon">üîç</span> Debug
            </button>
            <button class="nav-btn" onclick="toggleTheme()">
                <span class="icon" id="theme-icon">üåô</span>
                <span id="theme-text">Mode Gray - blue</span>
            </button>
            <button class="nav-btn" onclick="showHelp()">
                <span class="icon">‚ùì</span> Aide
            </button>
        </nav>
    </header>

    <!-- Contenu principal -->
    <main class="main-content voice-hidden">
        <!-- Zone dialogue (gauche haut) -->
        <aside class="dialogue-section">
            <section class="dialogue-section">
                <div class="dialogue-header">
                    <h2>üí¨ Conversation</h2>
                    <div class="dialogue-controls">
                        <button id="mute-btn" class="control-btn" onclick="toggleMute()" title="D√©sactiver la voix">
                            üîä
                        </button>
                        <button class="control-btn" onclick="clearConversation()" title="Effacer la conversation">
                            üóëÔ∏è
                        </button>
                        <button class="control-btn" onclick="exportConversation()" title="Exporter">
                            üíæ
                        </button>
                    </div>
                </div>
                
                <div class="dialogue-container" id="dialogue-container">
                    <div class="message-bubble system">
                        <div class="message-content">
                            <p>üöÄ Connexion √† votre assistant virtuel en cours...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Zone saisie (gauche bas) -->
            <section class="input-section">
                <div class="input-container">
                    <div class="input-row">
                        <textarea 
                            id="message-input" 
                            placeholder="Tapez votre message ici ou utilisez le microphone..."
                            rows="3"
                            onkeydown="handleInputKeydown(event)"
                        ></textarea>
                        
                        <div class="input-buttons">
                            <button 
                                class="mic-button" 
                                id="mic-button"
                                onclick="toggleVoiceInput()"
                                title="Activer/D√©sactiver le microphone"
                            >
                                <span class="mic-icon">üé§</span>
                                <span class="mic-status">Parler</span>
                            </button>
                            
                            <button 
                                class="send-button"
                                onclick="sendMessage()"
                                title="Envoyer le message"
                            >
                                ‚û§
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </aside>
        <!-- Voice Lab Panel -->
        <aside class="voice-section" id="voice-section">
            <div class="voice-header">
                <h3>üé≠ Laboratoire Vocal</h3>
                <button onclick="toggleVoiceLab()" class="close-voice">‚úñ</button>
            </div>
            
            <div class="setting-group">
                <!-- Formulaire de clonage -->
                <div class="voice-clone-form">
                    <h4>Cr√©er une nouvelle voix</h4>
                    
                    <input type="text" 
                    id="voice-name-input" 
                    placeholder="Nom de la voix"
                    maxlength="50"
                    required>
                    
                    <textarea id="voice-description-input" 
                            placeholder="Description (optionnel)"
                            rows="2"></textarea>
                    
                    <div class="debug-tabs"><span></span>
                        <button id="btn-primary" onclick="startVoiceRecording()" class="btn-primary">
                            üéôÔ∏è Enregistrer (10s max)
                        </button>
                        <button id="btn-secondary" onclick="stopVoiceRecording()" style="display:none" class="btn-danger">
                            ‚èπÔ∏è Arr√™ter
                        </button>
                        <div id="recording-indicator" class="recording-indicator"></div>
                        <div id="recording-timer" style="display:none"></div>
                    </div>
                    
                    <!-- Upload fichier -->
                    <div class="upload-option">
                        <label class="file-upload-label">
                            <input type="file" 
                                id="voice-upload" 
                                accept="audio/*,video/*"
                                style="display:none">
                            üìÅ Charger un fichier audio/vid√©o
                        </label>
                        <small>Formats: MP3, WAV, OGG, MP4, AVI, MKV... (Max 50MB)</small>
                    </div>
                </div>
                
                
            <!-- Aper√ßu audio -->
            <div id="audio-preview" style="display:none"></div>
            
            <!-- Bouton de sauvegarde -->
            <div class="form-actions">
                <button id="save-voice-btn" 
                        onclick="saveClonedVoice()" 
                        class="btn-success"
                        disabled>
                    üíæ Sauvegarder la voix
                </button>
                <button onclick="resetVoiceForm()" class="btn-secondary">
                    üîÑ R√©initialiser
                </button>
            </div>
        
            <!-- Section test -->
            <div class="test-section">
                <h4>üîä Tester une voix</h4>
                <div class="form-group">
                    <textarea id="test-text-input" 
                            placeholder="Texte √† tester (optionnel)"
                            rows="2">Bonjour, ceci est un test de ma voix clon√©e.</textarea>
                </div>
            </div>
            
            
            <!-- Liste des voix clon√©es -->
            <div class="cloned-voices-section">
                <h4>Mes voix clon√©es</h4>
                <div id="cloned-voices-list"></div>
            </div>
            
            <!-- Info XTTS -->
            <div class="xtts-info">
                <details>
                    <summary>‚ÑπÔ∏è √Ä propos du clonage vocal</summary>
                    <div class="info-content">
                        <p><strong>Technologies utilis√©es:</strong></p>
                        <ul>
                            <li>üéØ XTTS-v2 pour le clonage haute fid√©lit√©</li>
                            <li>üé§ Whisper pour la transcription</li>
                            <li>üîä Edge-TTS pour les voix pr√©d√©finies</li>
                        </ul>
                        <p><strong>Conseils pour un bon clonage:</strong></p>
                        <ul>
                            <li>Enregistrez dans un environnement calme</li>
                            <li>Parlez clairement et naturellement</li>
                            <li>Dur√©e optimale: 10-20 secondes</li>
                            <li>√âvitez les bruits de fond</li>
                        </ul>
                    </div>
                </details>
            </div>
            </div>
        </aside>

        <!-- Camera Panel -->
        <aside class="camera-section" id="camera-section">
            <div class="camera-header">
                <h3>üì∑ Vision IA</h3>
                <button class="close-camera" onclick="toggleCameraPanel()" >‚úñ</button>
            </div>
            
            <div class="panel-content">
                <div class="camera-container">
                    <video id="camera-feed" autoplay playsinline></video>
                    <div id="camera-info"></div>
                </div>
                
                <div class="camera-tabs">
                    <button onclick="captureImage()" class="btn-primary">
                        üì∏ Capturer
                    </button>
                    <button onclick="switchCamera()" class="btn-secondary">
                        üîÑ Changer cam√©ra
                    </button>
                    <button onclick="toggleCameraFilters()" class="btn-secondary">
                        üé® Filtres
                    </button>
                </div>
                
                <div id="captured-images" class="captured-images-grid"></div>
                
                <div id="analysis-options"></div>
                
                <div id="camera-dev-status"></div>
            </div>
        </aside>

        <!-- Zone debug/logs (droite) -->
        <aside class="debug-section" id="debug-section">
            <div class="debug-header">
                <h3>üîç Debug & Logs</h3>
                <button class="close-debug" onclick="toggleDebug()">‚úï</button>
            </div>
            
            <div class="debug-tabs">
                <button class="tab-btn active" onclick="switchDebugTab('logs')">Logs</button>
                <button class="tab-btn" onclick="switchDebugTab('stats')">Stats</button>
                <button class="tab-btn" onclick="switchDebugTab('config')">Config</button>
            </div>
            
            <div class="debug-content">
                <!-- Onglet Logs -->
                <div id="debug-logs" class="debug-tab active">
                    <div class="log-container" id="log-container">
                        <div class="log-entry info">
                            <span class="log-time">--:--:--</span>
                            <span class="log-message">Interface web initialis√©e</span>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Stats -->
                <div id="debug-stats" class="debug-tab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-messages">0</div>
                            <div class="stat-label">Messages</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-tokens">0</div>
                            <div class="stat-label">Tokens</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-avgtime">0.0s</div>
                            <div class="stat-label">Temps Moyen</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-tts-efficiency">100%</div>
                            <div class="stat-label">Efficacit√© TTS</div>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Config -->
                <div id="debug-config" class="debug-tab">
                    <div class="config-item">
                        <label>Personnalit√©:</label>
                        <span id="config-personality">-</span>
                    </div>
                    <div class="config-item">
                        <label>Mod√®le LLM:</label>
                        <span id="config-llm">-</span>
                    </div>
                    <div class="config-item">
                        <label>Mod√®le TTS:</label>
                        <span id="config-tts">-</span>
                    </div>
                    <div class="config-item">
                        <label>P√©riph√©rique Audio:</label>
                        <span id="config-audio">-</span>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Modal Param√®tres -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Param√®tres</h2>
                <button class="modal-close" onclick="closeSettings()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="tab-btn active" onclick="switchSettingsTab('voice')">üîä Voix</button>
                    <button class="tab-btn" onclick="switchSettingsTab('audio')">üé§ Audio</button>
                    <button class="tab-btn" onclick="switchSettingsTab('llm')">üß† LLM</button>
                    <button class="tab-btn" onclick="switchSettingsTab('interface')">üé® Interface</button>
                </div>
                
                <div class="settings-content">
                    <!-- Param√®tres Voix -->
                    <div id="settings-voice" class="settings-tab active">
                        <div class="setting-group">
                            <label for="voice-personality">Personnalit√©:</label>
                            <select id="voice-personality">
                                <option value="Jarvis">Chargement...</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label for="voice-speed">Vitesse de parole:</label>
                            <input type="range" id="voice-speed" min="0.5" max="2.0" step="0.1" value="1.0">
                            <span id="voice-speed-value">1.0x</span>
                        </div>
                        
                        <div class="setting-group">
                            <label for="voice-volume">Volume:</label>
                            <input type="range" id="voice-volume" min="0" max="100" value="90">
                            <span id="voice-volume-value">90%</span>
                        </div>
                        
                        <button class="test-btn" onclick="testVoice()">üîä Tester la voix</button>
                    </div>
                    
                    <!-- Param√®tres Audio -->
                    <div id="settings-audio" class="settings-tab">
                        <div class="setting-group">
                            <label for="audio-device">Microphone:</label>
                            <select id="audio-device">
                                <option value="default">P√©riph√©rique par d√©faut</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label for="audio-sensitivity">Sensibilit√©:</label>
                            <input type="range" id="audio-sensitivity" min="1" max="10" value="5" title="D√©finit l'agressivit√© de la d√©tection vocale. Augmenter si Jarvis vous coupe la parole. Diminuer s'il a du mal √† d√©tecter votre voix.">
                            <span id="audio-sensitivity-value">5</span>
                        </div>
                        
                        <button class="test-btn" onclick="testMicrophone()">üé§ Tester le micro</button>
                    </div>
                    
                    <!-- Param√®tres LLM -->
                    <div id="settings-llm" class="settings-tab">
                        <div class="setting-group">
                            <label for="llm-model">Mod√®le:</label>
                            <select id="llm-model">
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="role-select">
                                <i class="icon">üë®‚Äçüè´</i> R√¥le
                            </label>
                            <div class="flex gap-2">
                                <select id="role-select" class="select-input flex-grow">
                                    <!-- Sera peupl√© dynamiquement -->
                                </select>
                                <button onclick="promptManager.openManager()" class="btn-secondary" title="G√©rer les r√¥les">‚úèÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <label for="llm-temperature">Cr√©ativit√© (Temperature):</label>
                            <input type="range" id="llm-temperature" min="0.1" max="1.0" step="0.1" value="0.7">
                            <span id="llm-temperature-value">0.7</span>
                        </div>
                    </div>

                    <!-- Param√®tres Prompts (Nouveau Tab) -->
                    <div id="settings-prompts" class="settings-tab" style="display:none">
                        <div class="flex justify-between items-center mb-4">
                            <h3>Gestion des R√¥les</h3>
                            <button onclick="promptManager.createNew()" class="btn-success">+ Nouveau</button>
                        </div>
                        <div id="roles-list-container" class="roles-grid">
                            <!-- Liste des r√¥les -->
                        </div>
                        <button onclick="switchSettingsTab('llm')" class="btn-secondary mt-4">Retour</button>
                    </div>
                    
                    <!-- Param√®tres Interface -->
                    <div id="settings-interface" class="settings-tab">
                        <div class="setting-group">
                            <label for="interface-theme">Th√®me:</label>
                            <select id="interface-theme">
                                <option value="light">Light</option>
                                <option value="dark">Gray - blue</option>
                                <option value="jarvis">Dark - green</option>
                            </select>
                        </div>
                        
                        <div class="setting-group">
                            <label for="interface-background">Arri√®re-plan:</label>
                            <select id="interface-background">
                                <option value="default">Par d√©faut</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="background-opacity">Transparence arri√®re-plan:</label>
                            <input type="range" id="background-opacity" min="5" max="100" step="5" value="30">
                            <span id="background-opacity-value">30%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="resetSettings()">R√©initialiser</button>
                <button class="btn-primary" onclick="saveSettingsFromModal()">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Modal Aide -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ùì Aide & Guide d'utilisation</h2>
                <button class="modal-close" onclick="closeHelp()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div class="help-section">
                    <h3>üé§ Utilisation du microphone</h3>
                    <p>Cliquez sur le bouton microphone pour commencer l'√©coute vocale. Parlez clairement et attendez la transcription.</p>
                    <p><kbd>Ctrl</kbd> + <kbd>M</kbd> : Activer le microphone</p>
                </div>
                
                <div class="help-section">
                    <h3>üí¨ Zone de conversation</h3>
                    <p>Tapez vos messages dans la zone de saisie ou utilisez Ctrl+Entr√©e pour envoyer rapidement.</p>
                    <p><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Space</kbd> : Focus sur la zone de saisie </p>
                    <p><kbd>Ctrl</kbd> + <kbd>Enter</kbd> : Valider le message</p>
                    <p><kbd>Ctrl</kbd> + <kbd>f</kbd> : Changer de th√®me</p>
                </div>
                
                <div class="help-section">
                    <h3>üîç Debug et logs</h3>
                    <p>Utilisez la zone debug (droite) pour surveiller les performances et diagnostiquer les probl√®mes.</p>
                    <p><kbd>Ctrl</kbd> + <kbd>d</kbd> : Ouvrir/Fermer l'onglet Debug</p>
                    <p><kbd>Ctrl</kbd> + <kbd>Shift</kbd>  + <kbd>c</kbd> : Exporter les logs</p>
                </div>
                
                <div class="help-section">
                    <h3>‚öôÔ∏è Param√®tres</h3>
                    <p>Personnalisez la voix, l'audio et l'interface selon vos pr√©f√©rences.</p>
                    <p><kbd>Ctrl</kbd> + <kbd>r</kbd> : Red√©marrer Jarvis</p>
                    <p><kbd>Ctrl</kbd> + <kbd>f</kbd> : Changer de th√®me</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- üß† Scripts Modulaires - Architecture Cerveau -->
    <!-- Ordre d'import CRITIQUE pour les d√©pendances -->
    
    <!-- 1. Variables globales et √©tat (Cortex Pr√©frontal) -->
    <script src="static/js/variables-globals.js"></script>
    
    <!-- 2. Fonctions utilitaires (Bo√Æte √† outils) -->
    <script src="static/js/utils.js"></script>
    
    <!-- 3. Chargeur de configuration (Hippocampe) -->
    <script src="static/js/config-loader.js"></script>
    <script src="static/js/Settings-frontend.js"></script>
    
    <!-- 4. Gestionnaire de th√®mes (Lobes Occipitaux) -->
    <script src="static/js/theme-manager.js"></script>
    
    <!-- 5. Debug et logs (Syst√®me de surveillance) -->
    <script src="static/js/debug-logger.js"></script>
    
    <!-- 6. Gestionnaire WebSocket (Thalamus) -->
    <script src="static/js/websocket-manager.js"></script>
    
    <!-- 7. Gestionnaire de messages (Lobes Temporaux) -->
    <script src="static/js/message-handler.js"></script>
    
    <!-- 8. Gestion des voix (Hypothalamus) -->
    <script src="static/js/voice-manager.js"></script>
    <script src="static/js/settings-modal.js"></script>
    <script src="static/js/mic-test.js"></script>
    <script src="static/js/voice-lab.js"></script>

    <!-- 9. Script specifique sur les outils annexe -->
    <script src="static/js/camera-panel.js"></script>
    <script src="static/js/prompt-manager.js"></script>

    <!-- 10. Coordination principale (Tronc C√©r√©bral) -->
    <script src="static/js/app-main.js"></script>
         
</body>
</html>